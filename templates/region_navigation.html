{% extends 'base.html' %}
{% block content %}
<div id="content">
	<script type="text/javascript" charset="utf-8">
		var widgetActivators = {};
	</script>
	{% for widget in widgets %}
	<!-- begin {{widget}} -->
	{% include widget %}
	<!-- end {{widget}} -->
	{% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/src/display_mdg_table.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" charset="utf-8">
	$.each(widgetActivators, function(i,x){x()});
	
	var linkDests = ['mdg-indicators', 'facilities']
	var mdgLink = $("<a>", {'href':'#/mdg_indicators', 'class':'mode-link'}).text("MDG Indicators").data('link-dest', linkDests[0]);
	var facilitiesLink = $("<a>", {'href':'#/facilities', 'class':'mode-link'}).text("Facilities").data('link-dest', linkDests[1]);
	
	$('p.region-breadcrumbs').eq(0).append(facilitiesLink).append(mdgLink);
	
	function coolButt(l) {
		//coolifies the button.
		var hw = [l.outerHeight(), l.outerWidth()];
		l.wrapInner("<span class='a' />");
		var b = $("<span />", {'class':'b'}).css({display:'block', height: hw[0], width: hw[1]});
		var c = $("<span />", {'class':'c'}).css({display:'block', height: hw[0], width: hw[1]});
		l.append(b);
		l.append(c);
	}
	coolButt(mdgLink);
	coolButt(facilitiesLink);
	
	function clickCoolLink(evt) {
		var modeDest = $(this).data('link-dest'),
			content = $("#content");
		
		if(content.data('mode')!==modeDest) {
			$('#content').trigger('modeChange', {'mode':modeDest});
		}
		$(this).blur();
		evt.preventDefault();
	}
	$(mdgLink).click(clickCoolLink);
	$(facilitiesLink).click(clickCoolLink);
	
	(function($){
		var content = $("#content");
		$('#content').bind('modeChange', function(evt, md){
			var mode = md.mode,
				content = $('#content');
			content.data('mode', mode);
			$.each(linkDests, function(i, cln){
				if(cln==mode) {content.addClass(cln);} else {content.removeClass(cln);}
			});
			var modeLinks = $('p.region-breadcrumbs').find('a.mode-link');
			modeLinks.each(function(i, e){
				var z = $(e).data('link-dest');
				if(z==mode) {
					$(e).addClass('selected');
				} else {
					$(e).removeClass('selected');
				}
			});
		});
	})(jQuery)
	
	if($('#content').data('mode')==undefined) {
		$('#content').trigger('modeChange', {mode:'mdg-indicators'});
	}
</script>
{% endblock %}